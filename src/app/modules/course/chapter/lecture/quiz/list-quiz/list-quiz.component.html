@if (loading) {
<div class="loading-container">
    <div class="spinner"></div>
    <p class="loading-text">Loading...</p>
</div>
}

@if (activeModal !== 'none') {
<div class="modal-overlay">
    
    @if (activeModal === 'delete') {
    <div class="modal-card delete-card">
        <i class="bi bi-exclamation-triangle-fill warning-icon"></i>
        <h3>Permanent Delete?</h3>
        <p>Are you sure you want to delete <strong>{{ confirmData.title }}</strong>?</p>
        <div class="modal-actions">
            <button class="btn-cancel" (click)="closeModal()">Cancel</button>
            <button class="btn-confirm" (click)="confirmDeleteYes()">Confirm Delete</button>
        </div>
    </div>
    }

    @if (activeModal === 'quizForm') {
    <div class="modal-card form-card">
        <div class="modal-header">
            <h3>{{ isEditMode ? 'Edit Quiz' : 'Add New Quiz' }}</h3>
            <button class="close-btn" (click)="closeModal()"><i class="bi bi-x"></i></button>
        </div>
        <form [formGroup]="quizForm" (ngSubmit)="submitQuiz()">
            <div class="form-group">
                <label>Title</label>
                <input type="text" formControlName="title" placeholder="Enter quiz title">
            </div>

            <div class="form-group">
                <label>Description</label>
                <textarea formControlName="description" rows="3" placeholder="Enter a short description"></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Time (Minutes)</label>
                    <input type="number" formControlName="quizTime">
                </div>
                <div class="form-group">
                    <label>Attempts</label>
                    <input type="number" formControlName="quizTryCount">
                </div>
            </div>
            <button type="submit" class="btn-submit" [disabled]="loading">
                {{ isEditMode ? 'Update Quiz' : 'Save Quiz' }}
            </button>
        </form>
    </div>
    }

    @if (activeModal === 'questionForm') {
    <div class="modal-card form-card large">
        <div class="modal-header">
            <h3>{{ isEditMode ? 'Edit Question' : 'Add New Question' }}</h3>
            <button class="close-btn" (click)="closeModal()"><i class="bi bi-x"></i></button>
        </div>
        <form [formGroup]="questionForm" (ngSubmit)="submitQuestion()">
            <div class="form-grid">
                <div class="form-group">
                    <label>Question Text</label>
                    <input type="text" formControlName="title" placeholder="Type your question here...">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Question Type</label>
                        <select formControlName="questionTypeId">
                            <option value="" disabled>Select Type</option>
                            @for (type of questionTypes; track type.id) {
                            <option [value]="type.id">{{ type.name }}</option>
                            }
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Question Bank</label>
                        <select formControlName="questionBankId">
                            <option value="">No Bank (Optional)</option>
                            @for (bank of questionBanks; track bank.id) {
                            <option [value]="bank.id">{{ bank.name }}</option>
                            }
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Score</label>
                        <input type="number" formControlName="score">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Image (Optional)</label>
                    <input type="file" (change)="onFileSelected($event)" accept="image/*" class="file-input">
                </div>

                <div class="answers-section">
                    <div class="section-header">
                        <label><i class="bi bi-list-check"></i> Answers</label>
                        <button type="button" class="btn-add-ans" (click)="addAnswer()">
                            <i class="bi bi-plus"></i> Add Answer
                        </button>
                    </div>
                    <div formArrayName="answers" class="answers-list">
                        @for (ans of answers.controls; track $index; let i = $index) {
                        <div [formGroupName]="i" class="answer-row">
                            <div class="check-wrapper" title="Correct Answer?">
                                <input type="checkbox" formControlName="isCorrect">
                            </div>
                            <input type="text" formControlName="answer" placeholder="Answer text">
                            <button type="button" class="btn-remove" (click)="removeAnswer(i)">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                        }
                    </div>
                </div>
            </div>
            <button type="submit" class="btn-submit" [disabled]="loading">
                {{ isEditMode ? 'Update Question' : 'Save Question' }}
            </button>
        </form>
    </div>
    }
</div>
}

<div class="lecture-header">
    <h2><i class="bi bi-journal-text"></i> {{ lecture?.title }}</h2>
    <button class="btn btn-create" (click)="openQuizForm()">
        <i class="bi bi-plus-circle"></i> Create Quiz
    </button>
</div>

@for (quiz of lecture?.quizzes; track quiz.id) {
<div class="quiz-card">
    <div class="quiz-header">
        <div class="quiz-title-area">
            <h3><i class="bi bi-card-list"></i> {{ quiz.title }}</h3>
            @if (quiz.description) {
                <p class="quiz-desc-text">{{ quiz.description }}</p>
            }
        </div>
        <div class="quiz-actions">
            <button class="btn-create-question" (click)="openQuestionForm(quiz.id)" title="Add Question">
                <i class="bi bi-plus-circle"></i>
            </button>
            <button class="btn-edit" (click)="openQuizForm(quiz)" title="Edit"><i class="bi bi-pencil-square"></i></button>
            <button class="btn-delete" (click)="initDelete(quiz, 'quiz')" title="Delete"><i class="bi bi-trash"></i></button>
        </div>
    </div>

    @for (question of quiz.questions; track question.id) {
    <div class="question-card">
        <div class="question-header">
            <strong><i class="bi bi-question-circle"></i> {{ question.title }}</strong>
            <div class="badges">
                <span class="score">[{{ question.score }} pts]</span>
                <span class="type">({{ question.questionTypeName }})</span>
            </div>
            <div class="actions">
                <button (click)="openQuestionForm(quiz.id, question)" title="Edit"><i class="bi bi-pencil-square"></i></button>
                <button class="delete" (click)="initDelete(question, 'question')" title="Delete"><i class="bi bi-trash-fill"></i></button>
            </div>
        </div>
        
        @if (question.logoUrl) {
            <div class="question-image"><img [src]="question.logoUrl" alt="Question media"></div>
        }

        <ul class="answers">
            @for (ans of question.answers; track ans.id) {
            <li [class.correct]="ans.isCorrect">
                <span>{{ ans.answer }}</span>
                <i class="bi" [class.bi-check-circle-fill]="ans.isCorrect" [class.bi-x-circle-fill]="!ans.isCorrect"></i>
            </li>
            }
        </ul>
    </div>
    }
</div>
}