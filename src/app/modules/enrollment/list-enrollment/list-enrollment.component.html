<div class="list-container">
  @if (showDeleteConfirm) {
    <div class="modal-overlay">
      <div class="form-card" style="max-width: 400px; text-align: center;">
        <i class="bi bi-person-x text-danger" style="font-size: 3rem;"></i>
        <h3>Remove Student?</h3>
        <p>Are you sure you want to remove <b>{{studentToDelete?.name}}</b> from this course?</p>
        <div class="modal-actions">
          <button class="btn-cancel" (click)="showDeleteConfirm = false">Cancel</button>
          <button class="btn-confirm bg-danger" (click)="deleteStudent()">Yes, Remove</button>
        </div>
      </div>
    </div>
  }

  @if (showDeleteAllConfirm) {
    <div class="modal-overlay">
      <div class="form-card" style="max-width: 400px; text-align: center;">
        <i class="bi bi-exclamation-triangle text-danger" style="font-size: 3rem;"></i>
        <h3>Clear All Data?</h3>
        <p>This will delete <b>ALL students</b> from <b>ALL courses</b>. This action is permanent!</p>
        <div class="modal-actions">
          <button class="btn-cancel" (click)="showDeleteAllConfirm = false">Cancel</button>
          <button class="btn-confirm bg-danger" (click)="deleteAllStudents()">Confirm Delete All</button>
        </div>
      </div>
    </div>
  }

  <div class="toolbar" style="gap: 10px; flex-wrap: wrap;">
    <div class="search-wrapper" style="flex: 2; min-width: 250px;">
      <i class="bi bi-search search-icon"></i>
      <input type="text" [(ngModel)]="search" (input)="onSearchChange()" placeholder="Search by name or email..." class="search-input-modern" />
    </div>
    
    <div class="filter-buttons" style="display: flex; gap: 8px;">
      <button class="btn-filter" [class.active]="isSubscribe" (click)="setSubscriptionFilter(true)">
        <i class="bi bi-check-circle"></i> Subscribed
      </button>
      <button class="btn-filter" [class.active]="!isSubscribe" (click)="setSubscriptionFilter(false)">
        <i class="bi bi-clock-history"></i> Pending
      </button>
      <button class="btn-delete-all" (click)="showDeleteAllConfirm = true">
        <i class="bi bi-trash"></i> Delete All
      </button>
    </div>
  </div>

  <div class="cards-grid" [class.content-loading]="loading && students.length === 0">
    @for (student of students; track student.id) {
      <div class="course-card">
        <div class="card-header">
          <div class="chapter-icon-placeholder" style="border-radius: 50%; overflow: hidden;">
            <img [src]="student.logoUrl || 'assets/images/default-avatar.png'" 
                 onerror="this.src='https://picsum.photos/100/100'"
                 style="width: 100%; height: 100%; object-fit: cover;">
          </div>
          <div class="dropdown-actions">
            <button class="dots-btn" (click)="$event.stopPropagation(); student['showMenu'] = !student['showMenu']">
              <i class="bi bi-three-dots-vertical"></i>
            </button>
            @if (student['showMenu']) {
              <div class="actions-menu" (mouseleave)="student['showMenu'] = false">
                <button (click)="toggleSubscription(student)">
                  <i class="bi" [ngClass]="student.isSubscibe ? 'bi-x-circle' : 'bi-check-circle'"></i>
                  {{ student.isSubscibe ? 'Unsubscribe' : 'Subscribe' }}
                </button>
              </div>
            }
          </div>
        </div>

        <div class="card-body">
          <div class="badge-group">
            <span class="custom-badge" [ngClass]="student.isSubscibe ? 'bg-success' : 'bg-warning'">
              {{ student.isSubscibe ? 'Active' : 'Pending' }}
            </span>
          </div>
          <h3 class="course-name">{{ student.name }}</h3>
          <p class="course-title"><i class="bi bi-journal-text"></i> {{ student.courseName }}</p>
          <p class="course-title" style="font-size: 0.75rem;"><i class="bi bi-clock"></i> {{ student.creationTime | date:'short' }}</p>
          
          <div class="social-bar">
            <a [href]="'https://wa.me/' + student.phoneNumber" target="_blank" class="social-icon whatsapp">
              <i class="bi bi-whatsapp"></i>
            </a>
            <a [href]="'https://t.me/+' + student.phoneNumber" target="_blank" class="social-icon telegram">
              <i class="bi bi-telegram"></i>
            </a>
            <span class="phone-number">{{student.phoneNumber}}</span>
          </div>
        </div>
      </div>
    }
  </div>

  @if (!loading && students.length === 0) {
    <div class="no-data">
      <i class="bi bi-people" style="font-size: 3rem; opacity: 0.3;"></i>
      <p>No students found for this filter.</p>
    </div>
  }

  @if (totalCount > pageSize) {
    <div class="pagination-modern">
      <button class="page-nav" [disabled]="pageNumber === 1" (click)="onPageChange(pageNumber - 1)">
        <i class="bi bi-chevron-left"></i>
      </button>
      @for (p of [].constructor(totalPages); track $index) {
        <button class="page-num" [class.active]="pageNumber === ($index + 1)" (click)="onPageChange($index + 1)">
          {{ $index + 1 }}
        </button>
      }
      <button class="page-nav" [disabled]="pageNumber === totalPages" (click)="onPageChange(pageNumber + 1)">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  }
</div>